formula = y ~ poly(x, k, raw = TRUE),
se = FALSE,
linewidth = 1,
aes(colour = factor(k))
)
) +
labs(
title = "Polynomial GLM fits with increasing degree",
subtitle = "True data-generating process is cubic (degree = 3)",
colour = "Polynomial degree (k)"
) +
theme_minimal()
ggplot(dat, aes(x, y)) +
geom_point(alpha = 0.3) +
map(
degrees,
\(k)
geom_smooth(
method = "glm",
formula = y ~ poly(x, k, raw = TRUE),
se = FALSE,
linewidth = 1,
aes(colour = factor(k))
)
) +
labs(
colour = "Polynomial degree (k)"
) +
theme_minimal()
library(mgcv)
library(gratia)
installed.packages("purrr")
install.packages("purrr", dependencies = TRUE)
library(gratia)
gratia
install.packages("purrr", dependencies = TRUE)
install.packages("purrr")
dat <- tibble(x = -10:20)
#| eval: true
#| message: false
#| warning: false
library(tidyverse)
dat <- tibble(x = -10:20)
dat <- tibble(x = -10:20)
poly_data  <- function(data, x,degree,coefs = NULL,noise_sd = 10) {
if (is.null(coefs)) {
coefs <- rep(1, degree + 1)
}
data %>%
mutate(
y = map(
{{x}},
\(xi) {
tibble(
power = 0:degree,
coef  = coefs
) %>%
mutate(term = coef * xi^power) %>%
summarise(sum(term), .groups = "drop") %>%
pull()
}
) %>% unlist(),
y = y + rnorm(length({{x}}), 0, noise_sd)
)
}
degrees <- c(1, 2, 3, 5, 10,15,20)
ggplot(dat, aes(x, y)) +
geom_point(alpha = 0.3) +
map(
degrees,
\(k)
geom_smooth(
method = "glm",
formula = y ~ poly(x, k, raw = TRUE),
se = FALSE,
linewidth = 1,
aes(colour = factor(k))
)
) +
labs(
colour = "Polynomial degree (k)"
) +
theme_minimal()
dat %>% poly_data(x,2,noise_sd=50) -> dat
degrees <- c(1, 2, 3, 5, 10,15,20)
ggplot(dat, aes(x, y)) +
geom_point(alpha = 0.3) +
map(
degrees,
\(k)
geom_smooth(
method = "glm",
formula = y ~ poly(x, k, raw = TRUE),
se = FALSE,
linewidth = 1,
aes(colour = factor(k))
)
) +
labs(
colour = "Polynomial degree (k)"
) +
theme_minimal()
library(gratia)
install.packages("purrr")
remove.packages("purrr")
install.packages("purrr")
install.packages("purrr")
remove.packages("purrr")
install.packages("purrr")
library(purrr)
install.packages("purrr")
install.packages("gratia")
library(gratia)
##
library(palmerpenguins)
library(tidyverse)
chinstrap <- penguins %>%
filter(species == "Chinstrap") %>%
drop_na(bill_length_mm, bill_depth_mm)
poly_data  <- function(data, x,degree,coefs = NULL,noise_sd = 10) {
if (is.null(coefs)) {
coefs <- rep(1, degree + 1)
}
data %>%
mutate(
y = map(
{{x}},
\(xi) {
tibble(
power = 0:degree,
coef  = coefs
) %>%
mutate(term = coef * xi^power) %>%
summarise(sum(term), .groups = "drop") %>%
pull()
}
) %>% unlist(),
y = y + rnorm(length({{x}}), 0, noise_sd)
)
}
dat %>% poly_data(x,2,noise_sd=50) -> dat
degrees <- c(1, 2, 3, 5, 10,15,20)
dat <- tibble(x = seq(-10,20,0.1))
dat <- tibble(x = seq(-10,20,0.1)) %>% poly_data(x,2,noise_sd=50)
degrees <- c(1, 2, 3, 5, 10,15,20)
ggplot(dat, aes(x, y)) +
geom_point(alpha = 0.3) +
map(
degrees,
\(k)
geom_smooth(
method = "glm",
formula = y ~ poly(x, k, raw = TRUE),
se = FALSE,
linewidth = 1,
aes(colour = factor(k))
)
) +
labs(
colour = "Polynomial degree (k)"
) +
theme_minimal()
dat <- tibble(x = seq(-10,20,0.1)) %>% poly_data(x,3,noise_sd=50)
degrees <- c(1, 2, 3, 5, 10,15,20)
ggplot(dat, aes(x, y)) +
geom_point(alpha = 0.3) +
map(
degrees,
\(k)
geom_smooth(
method = "glm",
formula = y ~ poly(x, k, raw = TRUE),
se = FALSE,
linewidth = 1,
aes(colour = factor(k))
)
) +
labs(
colour = "Polynomial degree (k)"
) +
theme_minimal()
dat <- tibble(x = seq(-10,20,0.1)) %>% poly_data(x,3,noise_sd=100)
degrees <- c(1, 2, 3, 5, 10,15,20)
ggplot(dat, aes(x, y)) +
geom_point(alpha = 0.3) +
map(
degrees,
\(k)
geom_smooth(
method = "glm",
formula = y ~ poly(x, k, raw = TRUE),
se = FALSE,
linewidth = 1,
aes(colour = factor(k))
)
) +
labs(
colour = "Polynomial degree (k)"
) +
theme_minimal()
dat <- tibble(x = seq(-10,20,0.1)) %>% poly_data(x,3,noise_sd=200)
degrees <- c(1, 2, 3, 5, 10,15,20)
ggplot(dat, aes(x, y)) +
geom_point(alpha = 0.3) +
map(
degrees,
\(k)
geom_smooth(
method = "glm",
formula = y ~ poly(x, k, raw = TRUE),
se = FALSE,
linewidth = 1,
aes(colour = factor(k))
)
) +
labs(
colour = "Polynomial degree (k)"
) +
theme_minimal()
dat <- tibble(x = seq(-10,20,0.1)) %>% poly_data(x,3,noise_sd=300)
degrees <- c(1, 2, 3, 5, 10,15,20)
dat <- tibble(x = seq(-10,20,0.1)) %>% poly_data(x,3,noise_sd=300)
degrees <- c(1, 2, 3, 5, 10,15,20)
ggplot(dat, aes(x, y)) +
geom_point(alpha = 0.3) +
map(
degrees,
\(k)
geom_smooth(
method = "glm",
formula = y ~ poly(x, k, raw = TRUE),
se = FALSE,
linewidth = 1,
aes(colour = factor(k))
)
) +
labs(
colour = "Polynomial degree (k)"
) +
theme_minimal()
dat <- tibble(x = seq(-10,20,0.1)) %>% poly_data(x,2,noise_sd=300)
degrees <- c(1, 2, 3, 5, 10,15,20)
ggplot(dat, aes(x, y)) +
geom_point(alpha = 0.3) +
map(
degrees,
\(k)
geom_smooth(
method = "glm",
formula = y ~ poly(x, k, raw = TRUE),
se = FALSE,
linewidth = 1,
aes(colour = factor(k))
)
) +
labs(
colour = "Polynomial degree (k)"
) +
theme_minimal()
dat <- tibble(x = seq(-10,20,0.1)) %>% poly_data(x,2,noise_sd=50)
degrees <- c(1, 2, 3, 5, 10,15,20)
ggplot(dat, aes(x, y)) +
geom_point(alpha = 0.3) +
map(
degrees,
\(k)
geom_smooth(
method = "glm",
formula = y ~ poly(x, k, raw = TRUE),
se = FALSE,
linewidth = 1,
aes(colour = factor(k))
)
) +
labs(
colour = "Polynomial degree (k)"
) +
theme_minimal()
dat <- tibble(x = seq(-10,20,0.1)) %>% poly_data(x,2,noise_sd=100)
degrees <- c(1, 2, 3, 5, 10,15,20)
ggplot(dat, aes(x, y)) +
geom_point(alpha = 0.3) +
map(
degrees,
\(k)
geom_smooth(
method = "glm",
formula = y ~ poly(x, k, raw = TRUE),
se = FALSE,
linewidth = 1,
aes(colour = factor(k))
)
) +
labs(
colour = "Polynomial degree (k)"
) +
theme_minimal()
dat <- tibble(x = -10:20)
dat <- tibble(x = -10:20)%>% poly_data(x,2,noise_sd=100)
degrees <- c(1, 2, 3, 5, 10,15,20)
ggplot(dat, aes(x, y)) +
geom_point(alpha = 0.3) +
map(
degrees,
\(k)
geom_smooth(
method = "glm",
formula = y ~ poly(x, k, raw = TRUE),
se = FALSE,
linewidth = 1,
aes(colour = factor(k))
)
) +
labs(
colour = "Polynomial degree (k)"
) +
theme_minimal()
dat <- tibble(x = -10:20)%>% poly_data(x,2,noise_sd=50)
degrees <- c(1, 2, 3, 5, 10,15,20)
ggplot(dat, aes(x, y)) +
geom_point(alpha = 0.3) +
map(
degrees,
\(k)
geom_smooth(
method = "glm",
formula = y ~ poly(x, k, raw = TRUE),
se = FALSE,
linewidth = 1,
aes(colour = factor(k))
)
) +
labs(
colour = "Polynomial degree (k)"
) +
theme_minimal()
dat <- tibble(x = -10:20)%>% poly_data(x,2,noise_sd=30)
degrees <- c(1, 2, 3, 5, 10,15,20)
ggplot(dat, aes(x, y)) +
geom_point(alpha = 0.3) +
map(
degrees,
\(k)
geom_smooth(
method = "glm",
formula = y ~ poly(x, k, raw = TRUE),
se = FALSE,
linewidth = 1,
aes(colour = factor(k))
)
) +
labs(
colour = "Polynomial degree (k)"
) +
theme_minimal()
degrees <- c(1, 2, 3, 5, 10)
ggplot(dat, aes(x, y)) +
geom_point(alpha = 0.3) +
map(
degrees,
\(k)
geom_smooth(
method = "glm",
formula = y ~ poly(x, k, raw = TRUE),
se = FALSE,
linewidth = 1,
aes(colour = factor(k))
)
) +
labs(
colour = "Polynomial degree (k)"
) +
theme_minimal()
degrees <- c(1, 2, 3, 5, 10,20)
ggplot(dat, aes(x, y)) +
geom_point(alpha = 0.3) +
map(
degrees,
\(k)
geom_smooth(
method = "glm",
formula = y ~ poly(x, k, raw = TRUE),
se = FALSE,
linewidth = 1,
aes(colour = factor(k))
)
) +
labs(
colour = "Polynomial degree (k)"
) +
theme_minimal()
mod_bill <- gam(
bill_depth_mm ~ s(bill_length_mm),
data = chinstrap,
method = "REML"
)
library(mgcv)
chinstrap <- penguins %>%
filter(species == "Chinstrap") %>%
drop_na(bill_length_mm, bill_depth_mm)
mod_bill <- gam(
bill_depth_mm ~ s(bill_length_mm),
data = chinstrap,
method = "REML"
)
summary(mod_bill)
mod_bill$sp
draw(mod_bill)
appraise(mod_bill)
library(downloadthis)
dat <- tibble(x = -10:20)%>% poly_data(x,2,noise_sd=30)
degrees <- c(1, 2, 3, 5, 10,20)
ggplot(dat, aes(x, y)) +
geom_point(alpha = 0.3) +
map(
degrees,
\(k)
geom_smooth(
method = "glm",
formula = y ~ poly(x, k, raw = TRUE),
se = FALSE,
linewidth = 1,
aes(colour = factor(k))
)
) +
labs(
colour = "Polynomial degree (k)"
) +
theme_minimal()
##
library(palmerpenguins)
library(mgcv)
chinstrap <- penguins %>%
filter(species == "Chinstrap") %>%
drop_na(bill_length_mm, bill_depth_mm)
mod_bill <- gam(
bill_depth_mm ~ s(bill_length_mm),
data = chinstrap,
method = "REML"
)
summary(mod_bill)
mod_bill$sp
draw(mod_bill)
mod_bill$sp
help(summary.gam)
appraise(mod_bill)
mod_log <- gam(y ~ s(x,k=2), family=binomial, method="REML",data=dat)
mod_bill <- gam(
bill_depth_mm ~ s(bill_length_mm,k=2),
data = chinstrap,
method = "REML"
)
summary(mod_bill)
appraise(mod_bill)
dat <- tibble(x = seq(0, 1, length.out = 20),
y = c(0, 0, 0, 0, 0, 1, 1, 1, 1, 1,
1, 1, 1, 1, 1, 0, 0, 0, 0, 0),
col = 1:20)
mod_log <- gam(y ~ s(x,k=2), family=binomial, method="REML",data=dat)
draw(mod_log)
mod_log <- gam(y ~ s(x), family=binomial, method="REML",data=dat)
draw(mod_log)
dat <- tibble(x = seq(0, 1, length.out = 20),
y = c(0, 0, 1, 0, 0, 1, 1, 1, 1, 1,
1, 1, 1, 1, 1, 0, 0, 1, 0, 0),
col = 1:20)
mod_log <- gam(y ~ s(x), family=binomial, method="REML",data=dat)
draw(mod_log)
draw(mod_log,scale="response")
draw(mod_log,scale="response")
mod_log <- gam(y ~ s(x), family=binomial,
method="REML",data=dat)
draw(mod_log,"response")
mod_log
draw(
smooth_estimates(mod_log, transform = TRUE)
)
draw(
smooth_estimates(mod_log, transform = TRUE)
)
draw(
smooth_estimates(mod_log, transform = TRUE)
)
mod_log <- gam(y ~ s(x), family=binomial,
method="REML",data=dat)
draw(
smooth_estimates(mod_log, transform = TRUE)
)
draw(
smooth_estimates(mod_log, transform = TRUE,scale="response")
)
plot(mod_log, pages = 1, trans = plogis,
shift = coef(mod_log)[1])
dat <- tibble(x = seq(0, 1, length.out = 20),
y = c(0, 0, 0, 0, 0, 1, 1, 1, 1, 1,
1, 1, 1, 1, 1, 0, 0, 0, 0, 0),
col = 1:20)
mod_log <- gam(y ~ s(x), family=binomial,
method="REML",data=dat)
plot(mod_log, pages = 1, trans = plogis,
shift = coef(mod_log)[1])
draw(mod_log, constant = coef(mod_log)[1], fun = inv_link(mod_log))
draw(mod_log, fun = inv_link(mod_log))
dat <- tibble(x = seq(0, 1, length.out = 20),
y = c(0, 1, 0, 0, 0, 1, 1, 1, 1, 1,
1, 1, 1, 1, 1, 0, 0, 1, 0, 0),
col = 1:20)
mod_log <- gam(y ~ s(x), family=binomial,
method="REML",data=dat)
draw(mod_log, fun = inv_link(mod_log))
draw(mod_log, constant = coef(mod_log)[1], fun = inv_link(mod_log))
inv_link
